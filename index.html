<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Instituto Oliver - Modo Carreira</title>
    
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        :root {
            --primary: #FFD700;
            --secondary: #000000;
            --background: #f0f2f5;
            --card: #ffffff;
            --text: #1f2937;
            --success: #10b981;
            --error: #ef4444;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--background);
            color: var(--text);
            padding: 20px;
            display: flex;
            justify-content: center;
            min-height: 100vh;
        }

        /* --- ESTILOS DA BARRA DE CARREIRA (NOVO) --- */
        .career-panel {
            background: #fff;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
            border: 1px solid #e5e7eb;
        }

        .rank-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .rank-title {
            font-size: 1.2rem;
            font-weight: 800;
            text-transform: uppercase;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .xp-bar-container {
            width: 100%;
            height: 12px;
            background-color: #e5e7eb;
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }

        .xp-bar-fill {
            height: 100%;
            transition: width 0.5s ease, background-color 0.5s ease;
            position: relative;
        }

        /* Efeito de brilho na barra */
        .xp-bar-fill::after {
            content: '';
            position: absolute;
            top: 0; left: 0; bottom: 0; right: 0;
            background: linear-gradient(90deg, rgba(255,255,255,0) 0%, rgba(255,255,255,0.4) 50%, rgba(255,255,255,0) 100%);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .rank-badge {
            padding: 5px 10px;
            border-radius: 6px;
            font-size: 0.8rem;
            font-weight: bold;
            color: white;
            background: #333;
        }

        /* --- FIM BARRA DE CARREIRA --- */

        .container {
            width: 100%;
            max-width: 800px;
        }

        .card {
            background: var(--card);
            border-radius: 16px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            margin-bottom: 20px;
        }

        .header {
            background: var(--secondary);
            color: var(--primary);
            padding: 2rem;
            text-align: center;
        }

        .content { padding: 2rem; }

        .btn {
            width: 100%;
            padding: 1rem;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .btn-primary { background: var(--primary); color: var(--secondary); }
        .btn-primary:hover { background: var(--primary-dark); transform: translateY(-2px); }

        .option-btn {
            width: 100%;
            padding: 1.2rem;
            margin-bottom: 1rem;
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            text-align: left;
            font-size: 1rem;
            color: var(--text);
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
        }
        
        .option-btn:hover { border-color: var(--primary); background: #fffbe6; }
        .option-btn.selected { border-color: var(--primary); background: #fff9db; font-weight: 600; }
        .option-letter {
            background: #f3f4f6;
            width: 30px; height: 30px;
            display: flex; align-items: center; justify-content: center;
            border-radius: 50%;
            margin-right: 15px;
            font-weight: bold;
            color: #666;
        }

        .result-card {
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1rem;
        }
        .result-card.correct { border-left: 5px solid var(--success); background: #f0fdf4; }
        .result-card.wrong { border-left: 5px solid var(--error); background: #fef2f2; }

    </style>
</head>
<body>

    <div id="root"></div>

    <script type="text/babel">

        // --- BANCO DE QUESTÕES (Exemplo Reduzido) ---
        // Adicione suas 50 ou 100 questões aqui!
        const QUESTIONS_BANK = [
            { id: 1, question: "Segundo a Lei 9.455/97, constitui crime de tortura:", options: ["Apenas violência física", "Violência ou grave ameaça causando sofrimento físico ou mental", "Apenas sofrimento físico", "Apenas por agente público", "Nenhuma das anteriores"], correctIndex: 1, explanation: "Art. 1º: Constranger alguém com emprego de violência ou grave ameaça, causando-lhe sofrimento físico ou mental." },
            { id: 2, question: "A pena para tortura simples é:", options: ["Detenção 1-3 anos", "Reclusão 1-5 anos", "Reclusão 2-8 anos", "Reclusão 4-10 anos", "Detenção 2-4 anos"], correctIndex: 2, explanation: "Reclusão de 2 a 8 anos (Art. 1º)." },
            { id: 3, question: "Se da tortura resulta morte, a pena é:", options: ["6-12 anos", "8-16 anos", "12-30 anos", "20-30 anos", "Perpétua"], correctIndex: 1, explanation: "Tortura qualificada pela morte: Reclusão de 8 a 16 anos." },
            { id: 4, question: "Aumenta-se a pena se cometido contra:", options: ["Homem adulto", "Gestante, criança, idoso", "Policial", "Rico", "Estrangeiro"], correctIndex: 1, explanation: "Aumenta de 1/6 a 1/3 contra vulneráveis (gestante, criança, adolescente, idoso, deficiente)." },
            { id: 7, question: "Aumenta-se a pena de tortura se cometido mediante:", options: ["Motivo fútil", "Sequestro", "Arma de fogo", "Duas ou mais pessoas", "Traição"], correctIndex: 1, explanation: "Art. 1º § 4º III: mediante sequestro. (Obs: 'duas pessoas' não é causa de aumento na tortura)." },
            { id: 8, question: "O crime de tortura é:", options: ["Afiançável", "Inafiançável e Prescritível", "Imprescritível", "Anistiável", "De menor potencial ofensivo"], correctIndex: 1, explanation: "Tortura é inafiançável e insuscetível de graça/anistia, mas prescreve." },
            { id: 48, question: "Competência para julgar tortura (Regra Geral):", options: ["Local da prisão", "Local do resultado (Consumação)", "Local da ação", "Domicílio da vítima", "Local da denúncia"], correctIndex: 1, explanation: "Regra do Art. 70 CPP: Teoria do Resultado." }
        ];

        // --- SISTEMA DE RANKS ---
        const RANKS = [
            { name: "Recruta", minScore: 0, color: "#9ca3af", icon: "fa-user" },
            { name: "Aspirante", minScore: 10, color: "#3b82f6", icon: "fa-chevron-up" },
            { name: "Agente", minScore: 30, color: "#10b981", icon: "fa-shield-halved" },
            { name: "Delegado", minScore: 60, color: "#f59e0b", icon: "fa-star" },
            { name: "CAVEIRA", minScore: 100, color: "#111827", icon: "fa-skull" } // O nível máximo
        ];

        function getRank(score) {
            // Encontra o maior rank que o score atual satisfaz
            return RANKS.slice().reverse().find(r => score >= r.minScore) || RANKS[0];
        }

        function getNextRank(score) {
            return RANKS.find(r => r.minScore > score) || { name: "Lenda", minScore: score * 1.5 };
        }

        function ProgressBar({ score }) {
            const currentRank = getRank(score);
            const nextRank = getNextRank(score);
            
            // Cálculo da porcentagem para o próximo nível
            const prevLimit = currentRank.minScore;
            const nextLimit = nextRank.minScore;
            const totalToNext = nextLimit - prevLimit;
            const progress = score - prevLimit;
            
            // Se já for Caveira (último rank), barra fica cheia
            let percentage = 0;
            if (currentRank.name === "CAVEIRA") {
                percentage = 100;
            } else {
                percentage = Math.min(100, Math.max(0, (progress / totalToNext) * 100));
            }

            return (
                <div className="career-panel">
                    <div className="rank-header">
                        <div className="rank-title" style={{ color: currentRank.color }}>
                            <i className={`fa-solid ${currentRank.icon}`}></i>
                            {currentRank.name}
                        </div>
                        <div className="rank-badge">
                            {score} Pontos de Carreira
                        </div>
                    </div>
                    
                    <div className="xp-bar-container">
                        <div 
                            className="xp-bar-fill" 
                            style={{ 
                                width: `${percentage}%`,
                                backgroundColor: currentRank.color
                            }}
                        ></div>
                    </div>
                    <div style={{fontSize: '0.8rem', color: '#666', marginTop: '5px', textAlign: 'right'}}>
                        {currentRank.name === "CAVEIRA" ? "Nível Máximo Atingido!" : `Faltam ${nextLimit - score} pts para ${nextRank.name}`}
                    </div>
                </div>
            );
        }

        function QuizApp() {
            // Estados do Quiz
            const [gameState, setGameState] = React.useState('start'); // start, playing, result
            const [currentQuestions, setCurrentQuestions] = React.useState([]);
            const [currentIndex, setCurrentIndex] = React.useState(0);
            const [answers, setAnswers] = React.useState({});
            
            // Estados de Carreira (Persistentes)
            const [career, setCareer] = React.useState(() => {
                const saved = localStorage.getItem('oliver_career_v1');
                return saved ? JSON.parse(saved) : { score: 0, questionStats: {} };
            });

            // Efeito para salvar carreira sempre que mudar
            React.useEffect(() => {
                localStorage.setItem('oliver_career_v1', JSON.stringify(career));
            }, [career]);

            // Iniciar Quiz
            const startQuiz = () => {
                // Sorteia 20 questões aleatórias
                const shuffled = [...QUESTIONS_BANK].sort(() => 0.5 - Math.random());
                setCurrentQuestions(shuffled.slice(0, Math.min(20, shuffled.length)));
                setCurrentIndex(0);
                setAnswers({});
                setGameState('playing');
            };

            // Processar Fim do Quiz (AQUI ESTÁ A MÁGICA DA MATEMÁTICA)
            const finishQuiz = () => {
                let newCareerScore = career.score;
                let newStats = { ...career.questionStats };

                // Itera sobre as respostas dessa rodada
                currentQuestions.forEach((q, idx) => {
                    const userAnswer = answers[idx];
                    const qID = q.id;

                    // Inicializa estatística da questão se não existir
                    if (!newStats[qID]) newStats[qID] = 0;

                    if (userAnswer === q.correctIndex) {
                        // ACERTOU
                        newStats[qID] += 1; // Aumenta o contador de acertos dessa questão
                        
                        // Lógica: Ganha 1 ponto a cada 2 acertos acumulados na mesma questão
                        if (newStats[qID] % 2 === 0) {
                            newCareerScore += 1;
                        }
                    } else {
                        // ERROU
                        if (userAnswer !== undefined) { // Só penaliza se respondeu errado (não se deixou em branco)
                            newCareerScore -= 1; 
                            if (newCareerScore < 0) newCareerScore = 0; // Não deixa ficar negativo
                        }
                    }
                });

                setCareer({ score: newCareerScore, questionStats: newStats });
                setGameState('result');
            };

            // Tela Inicial
            if (gameState === 'start') {
                return (
                    <div className="container">
                        <ProgressBar score={career.score} />
                        <div className="card">
                            <div className="header">
                                <h1><i className="fa-solid fa-scale-balanced"></i> Instituto Oliver</h1>
                                <p>Simulado de Leis Penais Especiais</p>
                            </div>
                            <div className="content">
                                <p style={{textAlign:'center', marginBottom: '20px', color: '#666'}}>
                                    O modo carreira está ativo! Seus acertos acumulam pontos para subir de patente.
                                    <br/>
                                    <strong>Regra:</strong> A cada 2 acertos na mesma questão = +1 Ponto. Errou = -1 Ponto.
                                </p>
                                <button className="btn btn-primary" onClick={startQuiz}>
                                    <i className="fa-solid fa-play"></i> COMEÇAR SIMULADO
                                </button>
                            </div>
                        </div>
                    </div>
                );
            }

            // Tela de Resultado
            if (gameState === 'result') {
                const sessionScore = currentQuestions.filter((q, i) => answers[i] === q.correctIndex).length;
                
                return (
                    <div className="container">
                        <ProgressBar score={career.score} />
                        
                        <div className="card">
                            <div className="header">
                                <h2>Resultado do Treino</h2>
                                <h1 style={{fontSize: '3rem'}}>{sessionScore}/{currentQuestions.length}</h1>
                            </div>
                            <div className="content">
                                <button className="btn btn-primary" onClick={startQuiz} style={{marginBottom:'20px'}}>
                                    <i className="fa-solid fa-rotate-right"></i> NOVO SIMULADO
                                </button>
                                
                                {currentQuestions.map((q, i) => {
                                    const userAns = answers[i];
                                    const isCorrect = userAns === q.correctIndex;
                                    const letters = ['A','B','C','D','E'];
                                    
                                    return (
                                        <div key={i} className={`result-card ${isCorrect ? 'correct' : 'wrong'}`}>
                                            <div style={{fontWeight: 'bold', marginBottom: '10px'}}>
                                                {i+1}. {q.question}
                                            </div>
                                            <div>
                                                <span style={{fontWeight:'bold'}}>Sua resposta: </span>
                                                {userAns !== undefined ? `${letters[userAns]}) ${q.options[userAns]}` : "Em branco"}
                                            </div>
                                            {!isCorrect && (
                                                <div style={{color: '#166534', marginTop: '5px'}}>
                                                    <span style={{fontWeight:'bold'}}>Correta: </span>
                                                    {letters[q.correctIndex]}) {q.options[q.correctIndex]}
                                                </div>
                                            )}
                                            <div style={{marginTop: '10px', fontSize: '0.9rem', color: '#555', background:'rgba(255,255,255,0.5)', padding:'10px', borderRadius:'5px'}}>
                                                <i className="fa-solid fa-circle-info"></i> {q.explanation}
                                            </div>
                                        </div>
                                    )
                                })}
                            </div>
                        </div>
                    </div>
                );
            }

            // Tela do Jogo (Quiz)
            const currentQ = currentQuestions[currentIndex];
            const letters = ['A','B','C','D','E'];

            return (
                <div className="container">
                    <ProgressBar score={career.score} />
                    
                    <div className="card">
                        <div className="header" style={{padding: '1.5rem'}}>
                            <div style={{display:'flex', justifyContent:'space-between', alignItems:'center'}}>
                                <span>Questão {currentIndex + 1} de {currentQuestions.length}</span>
                                <span style={{fontSize:'0.9rem', opacity:0.8}}>Direito Penal</span>
                            </div>
                            <div style={{width:'100%', background:'rgba(0,0,0,0.2)', height:'6px', borderRadius:'3px', marginTop:'10px'}}>
                                <div style={{width: `${((currentIndex+1)/currentQuestions.length)*100}%`, background:'var(--primary)', height:'100%', borderRadius:'3px', transition:'width 0.3s'}}></div>
                            </div>
                        </div>

                        <div className="content">
                            <h3 style={{marginBottom: '20px', lineHeight: '1.5'}}>{currentQ.question}</h3>
                            
                            {currentQ.options.map((opt, idx) => (
                                <button 
                                    key={idx}
                                    className={`option-btn ${answers[currentIndex] === idx ? 'selected' : ''}`}
                                    onClick={() => setAnswers({...answers, [currentIndex]: idx})}
                                >
                                    <span className="option-letter">{letters[idx]}</span>
                                    {opt}
                                </button>
                            ))}

                            <div style={{display:'flex', gap:'10px', marginTop:'20px'}}>
                                {currentIndex > 0 && (
                                    <button className="btn" style={{background:'#e5e7eb', color:'#374151'}} onClick={() => setCurrentIndex(currentIndex - 1)}>
                                        Voltar
                                    </button>
                                )}
                                <button 
                                    className="btn btn-primary" 
                                    onClick={() => {
                                        if (currentIndex < currentQuestions.length - 1) {
                                            setCurrentIndex(currentIndex + 1);
                                        } else {
                                            finishQuiz();
                                        }
                                    }}
                                    disabled={answers[currentIndex] === undefined}
                                >
                                    {currentIndex === currentQuestions.length - 1 ? 'FINALIZAR PROVA' : 'PRÓXIMA'}
                                    <i className="fa-solid fa-arrow-right"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<QuizApp />);

    </script>
</body>
</html>
